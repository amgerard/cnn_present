<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="600" height="400" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<form action="">
<input type="radio" id="cbxBlue" name="cls" checked="true">Blue<br>
<input type="radio" id="cbxRed" name="cls">Red<br>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/synaptic/1.0.8/synaptic.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.9.3/math.min.js"></script>
<script src="js/NN.js"></script>
<script>

var netA = new Network([2,4,4,1], 0.1, .5);
function train3() {
	var data = [];
	for (var i=0; i<trainingData.length; i++){
		var x = [trainingData[i]['input'][1],trainingData[i]['input'][2]];
		var y = trainingData[i]['output'];
		data.push(new DataSet(x, [y]));
	}
	netA.Train(data, 1000);
	W = [netA.Layers[1][0].Bias,
	     netA.Layers[1][0].InputSynapses[0].Weight,
	     netA.Layers[1][0].InputSynapses[1].Weight];
	console.log(W);
	return W;
}


/* ******** MathJs ******** */
// perceptron
/*
function sigmoid(z) {
	//return 1 / ( 1 + math.pow(math.e, X));
	return z.map(function(x){return 1/(1+math.pow(math.e,-x));})
}
*/
function cost(theta, X, y) {
	n = X._size[0];
}

function train2_5() {

	W = math.random([3], -0.1, 0.1);  // generate a matrix with random numbers
	learning_rate = .1;
	//X = math.matrix(trainingData.map(function(x){return x["input"];}));

	for(var epoch = 0; epoch < 10000; epoch++) {
		var index = Math.floor(Math.random() * (trainingData.length));
		x = trainingData[index]['input'];
		y = trainingData[index]['output'];
		res = math.dot(x,W);
		error = y - (res >= 0);
		W = math.add(W, math.multiply(x, learning_rate * error));
	}
	
	console.log(W);
	return W;
}

var imageData = null;
var trainingData = [];

function drawPoint(x,y){
  
  var cls = document.getElementById("cbxBlue").checked;
  var xCalc = x/600.0; //(x-300)/600.0
  var yCalc = y/400.0; //(x-200)/400.0
  trainingData.push({input: [1, xCalc, yCalc], output: [cls ? 1 : 0]});
  w = train3();

  // get stuff
  var c = document.getElementById("myCanvas");
  var ctx = c.getContext("2d");
 
  ctx.clearRect(0, 0, c.width, c.height); 
  // reset
  //if (imageData !== null)    
  //  ctx.putImageData(imageData, 0, 0);
  
  for (var i = 0; i < 600; i+=7) {
    for (var j = 0; j < 400; j+=7) {
      var xi = i / 600.0; 
      var yj = j / 400.0;
      //res = math.dot(w, [1, xi, yj])
      res = netA.Compute([xi, yj])
      ctx.fillStyle = res >= 0.5 ? '#9999FF' : '#FF9999';
      ctx.fillRect(i,j,i+7,j+7);
      /*ctx.beginPath();
      ctx.arc(i, j, 6, 0, 2 * Math.PI);
      //ctx.fillStyle = cls ? 'blue' : 'red';
      // res < 0.6 && res > 0.4 ? 'black' : 
      ctx.fill();*/
      //ctx.stroke();
    }
  }
  
  //
  for (var i=0; i<trainingData.length; i++){
  ctx.beginPath();
  //ctx.arc(100, 75, 5, 0, 2 * Math.PI);
  ctx.arc(trainingData[i].input[1]*600, trainingData[i].input[2]*400, 5, 0, 2 * Math.PI);
  ctx.fillStyle = trainingData[i].output[0] ? 'blue' : 'red';
  ctx.fill();
  ctx.stroke();
  }

  // save the state of  the canvas here
  //imageData = ctx.getImageData(0,0,c.width,c.height);
}

function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
      x: evt.clientX - rect.left,
      y: evt.clientY - rect.top
    };
}

// Add event listener for `click` events.
document.getElementById("myCanvas").addEventListener('click', function(event) {
    
    var pt = getMousePos(document.getElementById("myCanvas"), event);
    
    drawPoint(pt.x, pt.y);
    
    /*var x = event.pageX - elemLeft,
        y = event.pageY - elemTop;

    // Collision detection between clicked offset and element.
    elements.forEach(function(element) {
        if (y > element.top && y < element.top + element.height 
            && x > element.left && x < element.left + element.width) {
            alert('clicked an element');
        }
    });*/

}, false);

</script> 

</body>
</html>

